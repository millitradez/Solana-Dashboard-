<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Solana Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <meta name="theme-color" content="#667eea">
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    header { text-align: center; color: white; margin-bottom: 30px; }
    h1 { font-size: 2em; margin-bottom: 10px; }
    .card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .btn {
      background: linear-gradient(135deg, #00D4AA 0%, #00B894 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 1.1em;
      font-weight: 600;
      width: 100%;
      cursor: pointer;
    }
    .hidden { display: none; }
    .wallet-address { font-family: monospace; font-size: 0.9em; color: #666; word-break: break-all; }
    .alert {
      padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none;
    }
    .alert-success { background: #d4edda; color: #155724; }
    .alert-error { background: #f8d7da; color: #721c24; }
    .token-chip {
      display: inline-block;
      background: #f0f0f0;
      padding: 8px 15px;
      border-radius: 20px;
      margin: 5px;
      cursor: pointer;
    }
    .price { font-size: 2em; font-weight: bold; color: #667eea; }
    .change-up { color: #28a745; }
    .change-down { color: #dc3545; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üöÄ Solana Dashboard</h1>
      <p>Coin98 Compatible</p>
    </header>

    <div id="alert" class="alert"></div>

    <div class="card">
      <h2>üíº Wallet</h2>
      <button id="connectBtn" class="btn">üíé Connect Coin98 Wallet</button>
      <div id="walletInfo" class="hidden">
        <p class="wallet-address" id="address"></p>
        <p>Balance: <span id="balance">0</span> SOL</p>
        <button id="disconnectBtn" class="btn">Disconnect</button>
      </div>
    </div>

    <div class="card">
      <h2>üîç Token Search</h2>
      <input type="text" id="tokenInput" placeholder="Enter Solana token mint address">
      <button id="loadBtn" class="btn">Load Token</button>
      <div style="margin-top: 15px;">
        <span class="token-chip" data-addr="So11111111111111111111111111111111111111112">üü£ SOL</span>
        <span class="token-chip" data-addr="EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v">üíµ USDC</span>
      </div>
    </div>

    <div id="tokenCard" class="card hidden">
      <h2 id="tokenName">Token</h2>
      <p class="price" id="price">$0.00</p>
      <p id="change"></p>
      <p id="tokenAddr" style="font-size: 0.8em; color: #666;"></p>
    </div>
  </div>

  <script>
    let wallet = null;
    let addr = null;

    function showAlert(msg, type) {
      const alert = document.getElementById('alert');
      alert.textContent = msg;
      alert.className = `alert alert-${type}`;
      alert.style.display = 'block';
      setTimeout(() => alert.style.display = 'none', 4000);
    }

    document.getElementById('connectBtn').onclick = async () => {
      try {
        if (window.coin98?.sol) wallet = window.coin98.sol;
        else if (window.solana?.isPhantom) wallet = window.solana;
        else { showAlert('‚ö†Ô∏è Please use Coin98 browser', 'error'); return; }

        const resp = await wallet.connect();
        addr = resp.publicKey?.toString();
        document.getElementById('address').textContent = addr;
        document.getElementById('walletInfo').classList.remove('hidden');
        document.getElementById('connectBtn').classList.add('hidden');

        const conn = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'), 'confirmed');
        const balance = await conn.getBalance(new solanaWeb3.PublicKey(addr));
        document.getElementById('balance').textContent = (balance / 1e9).toFixed(4);
        showAlert('‚úÖ Connected!', 'success');
      } catch (err) {
        console.error(err);
        showAlert('‚ùå Connection failed', 'error');
      }
    };

    document.getElementById('disconnectBtn').onclick = async () => {
      if (wallet?.disconnect) await wallet.disconnect();
      wallet = null;
      addr = null;
      document.getElementById('walletInfo').classList.add('hidden');
      document.getElementById('connectBtn').classList.remove('hidden');
      showAlert('üëã Disconnected', 'info');
    };

    document.getElementById('loadBtn').onclick = async () => {
      const mint = document.getElementById('tokenInput').value.trim();
      if (!mint) return showAlert('Enter token mint address', 'error');

      try {
        // Step 1: Get token list to map mint -> symbol
        const listRes = await fetch('https://token.jup.ag/all');
        const tokenList = await listRes.json();
        const tokenInfo = tokenList.find(t => t.address === mint);
        if (!tokenInfo) { showAlert('Token not found on Jupiter list', 'error'); return; }

        // Step 2: Get price + change
        const priceRes = await fetch(`https://price.jup.ag/v6/price?ids=${tokenInfo.symbol}`);
        const priceData = await priceRes.json();
        const data = priceData.data[tokenInfo.symbol];

        document.getElementById('tokenName').textContent = `${tokenInfo.name} (${tokenInfo.symbol})`;
        document.getElementById('price').textContent = `$${data.price.toFixed(4)}`;
        const changeEl = document.getElementById('change');
        const change = data.priceChange24h;
        changeEl.textContent = `24h: ${change.toFixed(2)}%`;
        changeEl.className = change >= 0 ? 'change-up' : 'change-down';

        document.getElementById('tokenAddr').textContent = mint;
        document.getElementById('tokenCard').classList.remove('hidden');
        showAlert('‚úÖ Token loaded!', 'success');
      } catch (err) {
        console.error(err);
        showAlert('‚ùå Error loading token info', 'error');
      }
    };

    document.querySelectorAll('.token-chip').forEach(chip => {
      chip.onclick = () => {
        document.getElementById('tokenInput').value = chip.dataset.addr;
        document.getElementById('loadBtn').click();
      };
    });
  </script>
</body>
</html>
